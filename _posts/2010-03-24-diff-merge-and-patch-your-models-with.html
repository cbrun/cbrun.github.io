---
layout: post
title: Diff, Merge and Patch your Models with Helios
date: '2010-03-23T23:12:00.000-07:00'
tags:
- eclipsecon
- eclipse
- compare
- acceleo
modified_time: '2010-03-23T23:12:44.905-07:00'
thumbnail: https://3.bp.blogspot.com/_u5tMWln_Ie8/S6JBUCN2b7I/AAAAAAAAARY/E9hWcXn7EDs/s72-c/slide1.png
blogger_id: tag:blogger.com,1999:blog-5749374620125186414.post-5574820773702427430
blogger_orig_url: https://model-driven-blogging.blogspot.com/2010/03/diff-merge-and-patch-your-models-with.html
---

Ok, you're stuck at home, you are one of the numerous budget shortcuts victims ?  You did not had the chance to come at EclipseCon ?  Here is some kind of transcript of the talk I just gave:<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://3.bp.blogspot.com/_u5tMWln_Ie8/S6JBUCN2b7I/AAAAAAAAARY/E9hWcXn7EDs/s1600-h/slide1.png"><img style="float: left; margin: 0pt 10px 10px 0pt; cursor: pointer; width: 320px; height: 241px;" src="https://3.bp.blogspot.com/_u5tMWln_Ie8/S6JBUCN2b7I/AAAAAAAAARY/E9hWcXn7EDs/s320/slide1.png" alt="" id="BLOGGER_PHOTO_ID_5449990311519874994" border="0" /></a>This talk will tackle <b>team-working with models.</b> Once you use models in your development proces, they matters as much <b>as the source code</b>. Don't you want to be able to diff, merge or even patch your models just like with text files ?<br /><br />The good news is that unlike text files models have a semantic structure defined thanks to their ecore model, as such we're able to semantically compare the models, comparing the serialization (XMI or other..) is often meaningless.<br /><br />By the way I'm the project lead of EMF compare, the project has been contributed in Eclipse in early 2007,  at that time many EMF adopters realized that this piece was missing in the Modeling ecosystem and <b>this lack was often a blocker </b>!<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JBbUYeIfI/AAAAAAAAARg/FfgKCFrs68c/s1600-h/slide2.png"><img style="float: right; margin: 0pt 0pt 10px 10px; cursor: pointer; width: 320px; height: 239px;" src="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JBbUYeIfI/AAAAAAAAARg/FfgKCFrs68c/s320/slide2.png" alt="" id="BLOGGER_PHOTO_ID_5449990436655342066" border="0" /></a><br />So here we are, three years later. EMF Compare - in the EMF  Technology project at first-  graduated and is now part of the EMF project  itself !<br /><br />Just like Transaction, Validation or CDO, Compare is one of the many pieces you can reuse as a framework, or just as a tool. Its focus is quite narrow : comparing, merging and patching any kind of EMF model, the later being an UML model or a domain specific one.<br /><br />As we graduated we've been focusing on keeping <b>stable API you can rely on.</b>  We really think that EMF popularity is highly due to the fact that depending on it is easy as it is completely forward compatible. Working nicely as a pure Java jar library is another key asset of EMF, we tried to stick to that for the Compare project: our framework can be used as a Java jar, not depending on Equinox or any extension point.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://3.bp.blogspot.com/_u5tMWln_Ie8/S6JBm2VTvOI/AAAAAAAAARo/NZXrdoHBqAY/s1600-h/slide3.png"><img style="float: left; margin: 0pt 10px 10px 0pt; cursor: pointer; width: 320px; height: 239px;" src="https://3.bp.blogspot.com/_u5tMWln_Ie8/S6JBm2VTvOI/AAAAAAAAARo/NZXrdoHBqAY/s320/slide3.png" alt="" id="BLOGGER_PHOTO_ID_5449990634747444450" border="0" /></a><br /><br />We could phrase the Eclipse IDE spirit in  :<i> be extensible, be customizable, be integrated</i>. We are sticking to this motto too, you can extend or customize any part of the comparison process.<br /><br />The compare and merge features are completely integrated with the Eclipse Team API. When you launch a comparison from the workspace or from an history, if the file is in fact a model, EMF Compare will be opened and will show you the differences, allowing you to merge, or switch back to the serialization diff.<br /><br /><a href="https://literate.modeling.free.fr/modeling/compare/BasicsCVSSVNGit.swf"><br /><img style="float: right; margin: 0pt 0pt 10px 10px; cursor: pointer; width: 320px; height: 241px;" src="https://1.bp.blogspot.com/_u5tMWln_Ie8/S6JM-jhatqI/AAAAAAAAASo/vICGoy5rQZM/s320/demoplay.png" alt="" id="BLOGGER_PHOTO_ID_5450003136642725538" border="0" /></a>Let's have a look on the tool through a demo. This demo goes higher and higher in coolness, as such it's starting by comparing an <i>old fashioned</i> UML model on a <i>dying</i> CVS Repository.<br /><br />A bit more <i>cool </i>:  comparing a domain specific model on a SVN repository.<br /><br /><i>Total coolness</i> : comparing an XText DSLsemantically, merging it, on top of a GIT repository !<br /><br /><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JBxJWzrAI/AAAAAAAAARw/3VhugVeW-TQ/s1600-h/slide4.png"><img style="float: left; margin: 0pt 10px 10px 0pt; cursor: pointer; width: 320px; height: 241px;" src="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JBxJWzrAI/AAAAAAAAARw/3VhugVeW-TQ/s320/slide4.png" alt="" id="BLOGGER_PHOTO_ID_5449990811652697090" border="0" /></a><br />That's just the tip of the iceberg, EMF Compare has a few more features and is especially useful in a lot of contexts, rather than listing all these details I'll focus now on the inside, revealing you which kind of magic make this clock ticking.<br /><br /><br /><br /><br /><br /><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://3.bp.blogspot.com/_u5tMWln_Ie8/S6JB677TbEI/AAAAAAAAAR4/vI2YxC5iR8Y/s1600-h/slide5.png"><img style="float: right; margin: 0pt 0pt 10px 10px; cursor: pointer; width: 320px; height: 240px;" src="https://3.bp.blogspot.com/_u5tMWln_Ie8/S6JB677TbEI/AAAAAAAAAR4/vI2YxC5iR8Y/s320/slide5.png" alt="" id="BLOGGER_PHOTO_ID_5449990979846368322" border="0" /></a><br />As I said at the beginning, the good news comparing models is that we've got semantic information we're not comparing plain text.  There is a drawback though: models are graph and as such being able to match similar graphs is a complex and tricky problem.<br /><br />The first thing we have to do for a comparison is to match the elements from both versions of the model.  <div><br /></div><div>If you've got ID's that part is trivial, EMF Compare will use your ID's (either business one or technical ones). On the other hand if you don't, we are providing what we call the "generic match engine", this engine uses a few statistical metrics to match the elements.<br /><br />For a given element this engine will extract it's type information, the content values, its relations with other elements and its name if we can detect one.  Each piece of this extraction will be compared with other elements to compute a similarity coefficient, from this one we can try to get closer and closer to the perfect match.<br /><br />Once this engine has done it's job, it provides a Match Model grouping all this information and weaving the other models.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCH2WQoMI/AAAAAAAAASA/SCnoiG6B-EE/s1600-h/slide6.png"><img style="float: left; margin: 0pt 10px 10px 0pt; cursor: pointer; width: 320px; height: 238px;" src="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCH2WQoMI/AAAAAAAAASA/SCnoiG6B-EE/s320/slide6.png" alt="" id="BLOGGER_PHOTO_ID_5449991201687118018" border="0" /></a> It gets more complicated, (and then more interesting) when using source control management systems. Then you have to match three versions of a model: yours, the remote one, and the common ancestor between those versions.<br /><br />To do so we builds two match models, between your local version and the common ancestor, then between the remote version and the common ancestor, and we combine those two match models into one, weaving the three models altogether.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCMtB5zlI/AAAAAAAAASI/lOJbc0uglPw/s1600-h/slide7.png"><img style="float: right; margin: 0pt 0pt 10px 10px; cursor: pointer; width: 320px; height: 239px;" src="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCMtB5zlI/AAAAAAAAASI/lOJbc0uglPw/s320/slide7.png" alt="" id="BLOGGER_PHOTO_ID_5449991285085163090" border="0" /></a><br /><br />At this stage it should be obvious that the faster the match engine is, the faster you'll get a result.<br /><br />To be honest the generic match engine is not so fast, having little clue about the models it's matching it spends a lot of time browsing the structure, trying to match things which probably have no possibilities of being the same..<br /><br />Being aware of that we eased the definition of your own match engine specific to your Ecore model. In doing so no doubt you'll get better results and way faster.<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCSw3YODI/AAAAAAAAASQ/lMht6tWhZkg/s1600-h/slide8.png"><img style="float: left; margin: 0pt 10px 10px 0pt; cursor: pointer; width: 320px; height: 240px;" src="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCSw3YODI/AAAAAAAAASQ/lMht6tWhZkg/s320/slide8.png" alt="" id="BLOGGER_PHOTO_ID_5449991389193975858" border="0" /></a><br />Let's take a step back. What are we trying to do ?</div><div><br /></div><div>We are trying to change two versions of a graph into a set of events, in reality we are trying to re-construct "a posteriori" the history of the graph: what changes have been made to transform the original one to the new one.<br /><br /></div><div>Match computation is done by the Match Engine, the Diff one by the Diff Engine. This processor has to provide a Diff Model from a Match Model.</div><div><br />In fact, when you have the MatchModel, deducing the DiffModel is not a huge task, you basically have to browse the matched elements, checking for changed attributes and reference, and then create for each "unmatched element" the corresponding deletion or addition event.<br /><br />Here again, you can plug in your own diff engine, and you can even define your own diffs specific to your formalism.  Instead of having a "<i>stock value changed from 12 to 34</i>" event you can define yours as being "<i>stock value has been increased from 12 to 34</i>" and even aggregate several atomic diffs in a single top-level one.<br /><br /></div><div>Being a first class model itself, the diff model can be leveraged through model to model or model to text transformation to publish the changes to another format.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://1.bp.blogspot.com/_u5tMWln_Ie8/S6JCiX8jmOI/AAAAAAAAASY/aZQXDhGah4E/s1600-h/slide9.png"><img style="float: right; margin: 0pt 0pt 10px 10px; cursor: pointer; width: 320px; height: 240px;" src="https://1.bp.blogspot.com/_u5tMWln_Ie8/S6JCiX8jmOI/AAAAAAAAASY/aZQXDhGah4E/s320/slide9.png" alt="" id="BLOGGER_PHOTO_ID_5449991657382713570" border="0" /></a><br />Now you should have a basic understanding of what EMF compare is trying to solve and in which way. We've seen that stability both in term of API and code was our primary goal right now but does that means nothing new is being done in Compare ?<br /><br />For Helios we fixed many issues thanks to the community feedback, support for fragmented models and matching of referenced resources has been greatly improved.<br /><br />The primary feedback is bug reports, but we also had quite a few contributions among those a new API to scope the matching process and a whole new set of plugins to create model independent diffs resilent to transformations in the model you want to apply the diff on.<br /><br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCpqlNMdI/AAAAAAAAASg/ZNKe6M0W3io/s1600-h/slide10.png"><img style="float: left; margin: 0pt 10px 10px 0pt; cursor: pointer; width: 320px; height: 239px;" src="https://4.bp.blogspot.com/_u5tMWln_Ie8/S6JCpqlNMdI/AAAAAAAAASg/ZNKe6M0W3io/s320/slide10.png" alt="" id="BLOGGER_PHOTO_ID_5449991782644134354" border="0" /></a> So many things to discuss in such a short time frame.<div>Give it a try, EMF Compare is part of the Eclipse Modeling Platform SDK, download the package and you're done.<br /><div><br /></div><div> I would be happy to discuss with you, either IRL or through electronic means.  Please uses the EMF newsgroup, the bugzilla or the #eclipse-modeling IRC channel on freenode. We're also available and new trendy channels like Twitter : @bruncedric.<div><br /><br /><br />Want's more ? Have a try downloading <a href="https://www.eclipse.org/downloads/packages/release/helios/m6">the Eclipse Modeling Package !</a></div><div><span class="Apple-style-span"  style="font-family:georgia;"><span class="Apple-style-span"  style="font-size:medium;"><br /></span></span></div><div><span class="Apple-style-span"  style="font-family:georgia;"><span class="Apple-style-span"  style="font-size:medium;"><br /></span></span></div><span class="Apple-style-span" style="  border-collapse: collapse; line-height: 14px; "></span><div><span class="Apple-style-span"  style="font-size:medium;"><br /></span></div></div></div></div>